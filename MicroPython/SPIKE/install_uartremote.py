import ubinascii, uos, machine,uhashlib
from ubinascii import hexlify
b64="""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
"""

def calc_hash(b):
    return hexlify(uhashlib.sha256(b).digest()).decode()

# this is the hash of the compiled uartremote.mpy
hash_gen='bf67a2647611c61fbcd85be89cd9603544fea9d2c826377ec96d178829ab348e'

uartremote=ubinascii.a2b_base64(b64)
hash_initial=calc_hash(uartremote)

try: # remove any old versions of uartremote library
    uos.remove('/projects/uartremote.py')
    uos.remove('/projects/uartremote.mpy')
except OSError:
    pass

print('writing uartremote.mpy to folder /projects')
with open('/projects/uartremote.mpy','wb') as f:
    f.write(uartremote)
print('Finished writing uartremote.mpy.')
print('Checking hash.')
uartremote_check=open('/projects/uartremote.mpy','rb').read()
hash_check=calc_hash(uartremote_check)

print('Hash generated: ',hash_gen)
error=False
if hash_initial != hash_gen:
    print('Failed hash of base64 input : '+hash_initial)
    error=True
if hash_check != hash_gen:
    print('Failed hash of .mpy on SPIKE: '+hash_check)
    error=True

if not error:
    print('Uartremote library written succesfully. Resetting....')
    machine.reset()
else:
    print('Failure in Uartremote library!')

